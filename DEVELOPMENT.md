# 開発

dskd は md（マークダウン）ファイルでコンテンツを管理し、静的にビルドするブログシステムです。

## コンセプト

ブログのテンプレートを開発するときは、静的ウェブサイトのビルド環境と同じように。

ブログの記事を執筆するときは、md ファイルだけ触ればいいように。

テンプレートと原稿（コンテンツ）を可能な分離して、コンテンツの追加・編集ではを md ファイルにだけ関心を持てばいいように作りました。

静的ウェブサイトとしてビルドされるので、JS フレームワークとの親和性は考慮していません。

## ローカル環境構築

```bash
npm ci
npm start
```

ローカルサーバー `localhost:3000` が立ち上がります。

タスクランナーに gulp を利用しています。

### アセット

画像は gulp-imagemin で適当に圧縮しています。

CSS は Sass などのプリプロセッサーは使わず、素の CSS で記述して postcss でちょっとした処理を施すだけにしています。

JavaScript は外部ファイルではなくテンプレートに直接記述しています。

### テンプレート

pug を利用しています。

記事のメタ情報やブログの設定情報、年別リストやタグ別リストの情報が格納された巨大なオブジェクトを内部で受け取り、テンプレートで利用しています。

どのページがどのテンプレートを利用するのかは、md ファイルの YAML ブロックの `layout` フィールドで定義しています。

### data.json

テンプレートに渡される data.json は `./task/json/data.js` タスクで生成されます。

このタスクでは front-matter で記事 md をパースし、サブタスクの下記が実行されます。

- 記事ごとに前後の記事のリストを作る `neighbors.js`
- タグごとに記事リストを作る `tags.js`
- 年ごとに記事リストを作る `years.js`

これらのタスクは、テンプレートで使いやすいように加工された記事リストを返します。

テンプレートで新しい形の記事リストを表示したい場合は、data.js タスクで生成して data.json に格納するのが主なフローです。

## デプロイ

`npm run build` を実行するとプロジェクトルートに `dist/` ディレクトリが生成されます。

これをドキュメントルートとしてウェブサーバーでホスティングすればウェブサイトとして閲覧可能です。

dskd では Netlify を使ってデプロイ、ホスティングしています。
